<!-- Extended Patient Document Information Component -->
<div class="tab-pane fade {{ 'show active' if first_tab == 'document' else '' }}" id="document" role="tabpanel"
    aria-labelledby="document-tab">
    <h5><i class="fas fa-file-medical-alt me-2"></i>Document Information</h5>

    {% if patient_extended_data %}
    {% set doc_data = patient_extended_data.get('document_info', patient_extended_data.get('metadata', {})) %}

    <!-- Debug Document Data -->
    <div class="alert alert-success mb-3">
        <h6>DEBUG: Document Info Data Available</h6>
        <p><strong>Document Data Keys:</strong> {{ doc_data.keys() | list if doc_data else 'No document data' }}</p>
        <p><strong>Title:</strong> {{ doc_data.get('title', 'No title') }}</p>
        <p><strong>Creation Date:</strong> {{ doc_data.get('creation_date', 'No date') }}</p>
    </div>

    <!-- Document Metadata -->
    <div class="row mb-3">
        <div class="col-md-6">
            <div class="contact-info-card">
                <div class="contact-type">Document Title</div>
                <div class="contact-details">
                    {{ doc_data.get('title', patient_extended_data.get('document_title', 'Patient Summary')) }}
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="contact-info-card">
                <div class="contact-type">Document Type</div>
                <div class="contact-details">
                    {{ doc_data.get('type', cda_type|default('CDA Document')) }}
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-md-6">
            <div class="contact-info-card">
                <div class="contact-type">Creation Date</div>
                <div class="contact-details">
                    {{ doc_data.get('creation_date', doc_data.get('effective_time', 'Not specified')) }}
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="contact-info-card">
                <div class="contact-type">Document ID</div>
                <div class="contact-details">
                    {% if doc_data.get('document_id', {}).get('extension') %}
                    {{ doc_data.document_id.extension }}
                    {% else %}
                    {{ patient_identity.get('patient_id', 'Not available') }}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <div class="row mb-3">
        <div class="col-md-6">
            <div class="contact-info-card">
                <div class="contact-type">Language</div>
                <div class="contact-details">
                    {{ doc_data.get('language', source_language|default('en-GB')) }}
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="contact-info-card">
                <div class="contact-type">Version</div>
                <div class="contact-details">
                    {{ doc_data.get('version', '1.0') }}
                </div>
            </div>
        </div>
    </div>

    <!-- Document Status -->
    <div class="row mb-3">
        <div class="col-md-12">
            <h6><i class="fas fa-info-circle me-1"></i>Document Status</h6>
            <div class="contact-info-card">
                <div class="contact-details">
                    <span class="badge bg-success me-2">Active</span>
                    <span class="badge bg-info me-2">Encrypted</span>
                    {% if doc_data.get('confidentiality') %}
                    <span class="badge bg-warning">{{ doc_data.confidentiality }}</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Show message if no document info -->
    {% if not doc_data and not patient_extended_data.get('document_title') %}
    <div class="alert alert-info">
        <i class="fas fa-info-circle me-2"></i>Limited document information available.
    </div>
    {% endif %}

    {% else %}
    <div class="alert alert-warning">
        <i class="fas fa-exclamation-triangle me-2"></i>No extended patient data available.
    </div>
    {% endif %}
</div>