{% comment %}
Enhanced CDA Template with Comprehensive Administrative Data
Shows all available contact information and organizational data
{% endcomment %}

{% extends "base.html" %}
{% load patient_date_filters %}
{% load administrative_filters %}

{% block title %}Complete CDA View - {{ patient_identity.given_name }} {{ patient_identity.family_name }}{% endblock %}

{% block content %}

<!-- Patient Information with Enhanced Contact Data -->
<div class="wrap-collapsible">
    <input id="collapsible-patient-info" class="toggle" type="checkbox" checked="true">
    <label for="collapsible-patient-info" class="lbl-toggle-main">
        <i class="fas fa-user-md me-2"></i>
        Patient Information & Contact Details
        {{ administrative_data.patient_contact_info|contact_summary_badge }}
    </label>
    <div class="collapsible-content-main">
        <div class="content-inner-main">

            <!-- Basic Patient Info -->
            <div class="info-grid">
                <div class="info-item">
                    <span class="info-label">Patient Name:</span>
                    <span class="info-value">{{ patient_identity.family_name }}, {{ patient_identity.given_name
                        }}</span>
                </div>

                <div class="info-item">
                    <span class="info-label">Date of Birth:</span>
                    <span class="info-value">{{ patient_identity.birth_date|patient_birth_date }}</span>
                </div>

                <div class="info-item">
                    <span class="info-label">Age:</span>
                    <span class="info-value">{{ patient_identity.birth_date|patient_age }} years old</span>
                </div>

                {% if patient_identity.patient_identifiers %}
                {% for identifier in patient_identity.patient_identifiers %}
                <div class="info-item">
                    <span class="info-label">Patient ID{% if identifier.assigningAuthorityName %} ({{
                        identifier.assigningAuthorityName }}){% endif %}:</span>
                    <span class="info-value">{{ identifier.extension }}</span>
                </div>
                {% endfor %}
                {% endif %}
            </div>

            <!-- Enhanced Patient Contact Information -->
            {% if administrative_data.patient_contact_info|has_contact_info %}
            <div class="contact-section mt-4">
                <h5><i class="fas fa-address-book me-2"></i>Patient Contact Information</h5>

                <!-- Primary Contacts Summary -->
                <div class="primary-contacts-summary mb-3">
                    {% with administrative_data.patient_contact_info|get_primary_contact:"address" as primary_addr %}
                    {% if primary_addr %}
                    <div class="primary-contact-item">
                        <strong>Primary Address:</strong> {{ primary_addr|format_address }}
                    </div>
                    {% endif %}
                    {% endwith %}

                    {% with administrative_data.patient_contact_info|get_primary_contact:"phone" as primary_phone %}
                    {% if primary_phone %}
                    <div class="primary-contact-item">
                        <strong>Primary Phone:</strong> {{ primary_phone|format_telecom }}
                    </div>
                    {% endif %}
                    {% endwith %}

                    {% with administrative_data.patient_contact_info|get_primary_contact:"email" as primary_email %}
                    {% if primary_email %}
                    <div class="primary-contact-item">
                        <strong>Primary Email:</strong> {{ primary_email|format_telecom }}
                    </div>
                    {% endif %}
                    {% endwith %}
                </div>

                <!-- All Addresses -->
                {% if administrative_data.patient_contact_info.addresses %}
                <div class="contact-subsection">
                    <h6>All Addresses ({{ administrative_data.patient_contact_info.addresses|length }})</h6>
                    {% for address in administrative_data.patient_contact_info.addresses %}
                    <div class="contact-card">
                        <div class="address-item">
                            <strong>{{ address.use|default:"Unknown" }} Address:</strong>
                            <div class="address-details">
                                {% if address.street_address_line %}<div>üìç {{ address.street_address_line }}</div>{%
                                endif %}
                                {% if address.city %}<div>üèòÔ∏è {{ address.city }}</div>{% endif %}
                                {% if address.state %}<div>üó∫Ô∏è {{ address.state }}</div>{% endif %}
                                {% if address.postal_code %}<div>üìÆ {{ address.postal_code }}</div>{% endif %}
                                {% if address.country %}<div>üåç {{ address.country }}</div>{% endif %}
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}

                <!-- All Telecoms -->
                {% if administrative_data.patient_contact_info.telecoms %}
                <div class="contact-subsection">
                    <h6>All Contact Methods ({{ administrative_data.patient_contact_info.telecoms|length }})</h6>
                    <div class="telecoms-grid">
                        {% for telecom in administrative_data.patient_contact_info.telecoms %}
                        <div class="telecom-item">
                            {{ telecom|format_telecom }}
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
            {% else %}
            <div class="alert alert-info mt-4">
                <i class="fas fa-info-circle me-2"></i>
                No patient contact information available in this document.
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Enhanced Document & Administrative Information -->
<div class="wrap-collapsible">
    <input id="collapsible-admin-detailed" class="toggle" type="checkbox">
    <label for="collapsible-admin-detailed" class="lbl-toggle-main">
        <i class="fas fa-clipboard-list me-2"></i>
        Document & Administrative Details
    </label>
    <div class="collapsible-content-main">
        <div class="content-inner-main">

            <!-- Document Information -->
            <div class="admin-section">
                <h5><i class="fas fa-file-medical me-2"></i>Document Information</h5>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">Title:</span>
                        <span class="info-value">{{ administrative_data.document_title }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Type:</span>
                        <span class="info-value">{{ administrative_data.document_type }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Created:</span>
                        <span class="info-value">{{ administrative_data.document_creation_date }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">Document ID:</span>
                        <span class="info-value">{{ administrative_data.document_id }}</span>
                    </div>
                </div>
            </div>

            <!-- Author Information -->
            {% if administrative_data.author_information %}
            <div class="admin-section">
                <h5><i class="fas fa-user-md me-2"></i>Document Authors ({{
                    administrative_data.author_information|length }})</h5>
                {% for author in administrative_data.author_information %}
                <div class="author-card">
                    <div class="author-header">
                        <strong>{{ author|format_author_summary }}</strong>
                        {% if author.time %}
                        <span class="author-time">{{ author.time }}</span>
                        {% endif %}
                    </div>

                    {% if author.person.family_name and author.person.given_name %}
                    <div class="author-details">
                        <div><strong>Name:</strong> {{ author.person.full_name }}</div>
                        {% if author.role %}<div><strong>Role:</strong> {{ author.role }}</div>{% endif %}
                        {% if author.id.extension %}<div><strong>ID:</strong> {{ author.id.extension }}</div>{% endif %}
                    </div>
                    {% endif %}

                    {% if author.organization.name %}
                    <div class="author-organization">
                        <strong>Organization:</strong> {{ author.organization|format_organization_name }}
                        {% if author.organization.address %}
                        <div class="org-location">{{ author.organization|organization_address_summary }}</div>
                        {% endif %}
                        {% if author.organization.telecoms %}
                        <div class="org-contacts">{{ author.organization.telecoms|format_telecom_list }}</div>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            <!-- Custodian Organization -->
            <div class="admin-section">
                <h5><i class="fas fa-hospital me-2"></i>Custodian Organization</h5>
                <div class="organization-card">
                    <div class="org-header">
                        <strong>{{ administrative_data.custodian_organization|format_organization_name }}</strong>
                    </div>

                    {% if administrative_data.custodian_organization.address %}
                    <div class="org-details">
                        <div><strong>Address:</strong> {{
                            administrative_data.custodian_organization.address|format_address }}</div>
                    </div>
                    {% endif %}

                    {% if administrative_data.custodian_organization.telecoms %}
                    <div class="org-contacts">
                        <strong>Contact Methods:</strong>
                        <div>{{ administrative_data.custodian_organization.telecoms|format_telecom_list }}</div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Legal Authenticator -->
            {% if administrative_data.legal_authenticator.person.full_name %}
            <div class="admin-section">
                <h5><i class="fas fa-certificate me-2"></i>Legal Authenticator</h5>
                <div class="authenticator-card">
                    <div><strong>Name:</strong> {{ administrative_data.legal_authenticator.person.full_name }}</div>
                    {% if administrative_data.legal_authenticator.time %}
                    <div><strong>Authentication Time:</strong> {{ administrative_data.legal_authenticator.time }}</div>
                    {% endif %}
                    {% if administrative_data.legal_authenticator.signature_code %}
                    <div><strong>Signature Code:</strong> {{ administrative_data.legal_authenticator.signature_code }}
                    </div>
                    {% endif %}
                    {% if administrative_data.legal_authenticator.organization.name %}
                    <div><strong>Organization:</strong> {{ administrative_data.legal_authenticator.organization.name }}
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}

        </div>
    </div>
</div>

<!-- Contact Summary Card (Sidebar or Summary) -->
<div class="contact-summary-card mt-4">
    <h6><i class="fas fa-address-card me-2"></i>Quick Contact Summary</h6>
    {% render_contact_card administrative_data.patient_contact_info "Patient Contact" %}
</div>

{% comment %}
BENEFITS OF ENHANCED ADMINISTRATIVE DATA:

‚úÖ COMPREHENSIVE CONTACT EXTRACTION:
- Patient addresses with full details (street, city, state, postal, country)
- Multiple telecom methods (phone, email, fax, website)
- Primary contact identification for quick access

‚úÖ DETAILED ORGANIZATIONAL INFORMATION:
- Author information with roles and timestamps
- Custodian organization with full contact details
- Legal authenticator information for compliance

‚úÖ HEALTHCARE CONTEXT:
- Multiple healthcare professional authors
- Organizational relationships and hierarchies
- Authentication and signature information for legal compliance

‚úÖ INTERNATIONAL SUPPORT:
- Multi-country address formats
- International telecom formats
- Organizational structures across EU member states

‚úÖ USER EXPERIENCE:
- Primary contacts highlighted for quick access
- Contact summary badges for at-a-glance information
- Organized presentation of complex administrative data
- Template filters for consistent formatting

BEFORE: Only basic custodian name
AFTER: Complete organizational ecosystem with full contact details
{% endcomment %}

{% endblock %}