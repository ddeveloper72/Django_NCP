{% extends 'base.html' %}
{% load static %}
{% load patient_filters %}

{% block title %}Simplified Clinical Data - Patient {{ patient_identity.given_name }} {{ patient_identity.family_name }}{% endblock %}

{% block extra_css %}
<link href="{% static 'css/enhanced_cda.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="container-fluid mt-4">
    <!-- Patient Header -->
    <div class="patient-header mb-4">
        <div class="row">
            <div class="col-md-8">
                <h1 class="text-primary">
                    <i class="fa-solid fa-user-doctor me-2"></i>
                    Simplified Clinical Data View
                </h1>
                <h2 class="text-secondary">
                    {% if patient_identity %}
                    {{ patient_identity.given_name }} {{ patient_identity.family_name }}
                    {% if patient_identity.birth_time %}
                    <small class="text-muted">(DOB: {{ patient_identity.birth_time|date:"M d, Y" }})</small>
                    {% endif %}
                    {% else %}
                    Patient Clinical Data
                    {% endif %}
                </h2>
            </div>
            <div class="col-md-4 text-end">
                <a href="{% url 'patient_data:enhanced_cda_display_with_id' patient_id %}"
                   class="btn btn-outline-primary">
                    <i class="fa-solid fa-chart-bar me-1"></i>
                    Enhanced View
                </a>
            </div>
        </div>
    </div>

    <!-- Simplified Clinical Data Section -->
    <div class="simplified-clinical-container">
        {% if simplified_data %}
            {% include 'patient_data/sections/simplified_clinical_section_enhanced.html' %}
        {% else %}
            <div class="alert alert-warning">
                <i class="fa-solid fa-exclamation-triangle me-2"></i>
                <strong>No Simplified Clinical Data Available</strong><br>
                The simplified clinical data could not be generated for this patient.
            </div>
        {% endif %}
    </div>

    <!-- Debug Information (Development Only) -->
    {% if debug %}
    <div class="debug-info mt-5">
        <div class="card">
            <div class="card-header bg-secondary text-white">
                <h5 class="mb-0">Debug Information</h5>
            </div>
            <div class="card-body">
                <h6>Simplified Data Status:</h6>
                <pre class="small">{{ simplified_data|safe }}</pre>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Enhanced CDA JavaScript functionality -->
<script src="{% static 'js/enhanced_cda.js' %}"></script>
{% endblock %}
