{% load patient_filters %}
{# Medication Data Debug Template - Check what data is being passed #}

<div class="alert alert-info border border-primary p-4">
    <h5 class="text-primary">üîç Medication Data Debug Information</h5>
    
    <div class="mb-3">
        <strong>section_data Type:</strong> {{ section_data|pprint|slice:":100" }}...
    </div>
    
    <div class="mb-3">
        <strong>section_data Length:</strong> 
        {% if section_data %}
            {% if section_data|length %}
                {{ section_data|length }} items
            {% else %}
                Available but no length (not a list)
            {% endif %}
        {% else %}
            None/Empty
        {% endif %}
    </div>
    
    {% if section_data %}
    <div class="mb-3">
        <strong>First 3 items (if list):</strong>
        <ul>
        {% for item in section_data|slice:":3" %}
            <li>Item {{ forloop.counter }}: {{ item.name|default:item.display_name|default:item.medication_name|default:"NO_NAME" }}</li>
        {% empty %}
            <li>No items in list</li>
        {% endfor %}
        </ul>
    </div>
    {% endif %}
    
    <div class="mb-3">
        <strong>Available Template Context Variables:</strong>
        <ul>
            <li>medications: {% if medications %}{{ medications|length }} items{% else %}Not available{% endif %}</li>
            <li>med_list: {% if med_list %}{{ med_list|length }} items{% else %}Not available{% endif %}</li>
            <li>clinical_data: {% if clinical_data %}Available{% else %}Not available{% endif %}</li>
        </ul>
    </div>
    
    <div class="mt-3 p-3 bg-light">
        <small class="text-muted">
            <strong>Debug Purpose:</strong> This debug template helps identify if medication data is reaching the template
            and in what format. Remove this when the issue is resolved.
        </small>
    </div>
</div>

{# Show medication section normally below debug info #}
<div class="medical-section" id="medications-section">
    {% with section_data as med_list %}
    {% if med_list and med_list|length > 0 %}
    <div class="clinical-section">
        <div class="collapsible-wrapper">
            <input id="toggle-medications" class="toggle-input" type="checkbox" checked>
            <label for="toggle-medications" class="collapsible-label-title">
                <div class="clinical-section-title-row">
                    <div class="clinical-section-title">
                        <i class="fa-solid fa-pills me-2"></i>
                        <span>Medications</span>
                    </div>
                    <div class="clinical-badge-container">
                        <span class="clinical-badge populated">{{ med_list|length }} Found</span>
                    </div>
                </div>
                <i class="fas fa-chevron-down toggle-icon" aria-hidden="true"></i>
            </label>
            <div class="collapsible-content-title">
                <div class="content-inner-title">
                    <p class="mb-3 text-success">‚úÖ DEBUG: Found {{ med_list|length }} medications in section_data!</p>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <div class="clinical-section">
        <div class="collapsible-wrapper">
            <input id="toggle-medications" class="toggle-input" type="checkbox" checked>
            <label for="toggle-medications" class="collapsible-label-title">
                <div class="clinical-section-title-row">
                    <div class="clinical-section-title">
                        <i class="fa-solid fa-pills me-2"></i>
                        <span>Medications</span>
                    </div>
                    <div class="clinical-badge-container">
                        <span class="clinical-badge empty">0 Found</span>
                    </div>
                </div>
                <i class="fas fa-chevron-down toggle-icon" aria-hidden="true"></i>
            </label>
            <div class="collapsible-content-title">
                <div class="content-inner-title">
                    <div class="no-content-message p-4 text-center">
                        <i class="fa-solid fa-info-circle fa-2x mb-3 text-muted"></i>
                        <h6 class="text-muted">‚ùå DEBUG: No medication data in section_data</h6>
                        <p class="text-muted mb-0">Check service layer data flow and template variable passing.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
    {% endwith %}
</div>