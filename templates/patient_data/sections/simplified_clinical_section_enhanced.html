{% load patient_filters %}

{# =============================================== #}
{# SIMPLIFIED CLINICAL DATA TEMPLATE - ENHANCED #}
{# Clean, flexible data structures for easy customization #}
{# User can easily modify layouts, styling, and data presentation #}
{# =============================================== #}

<div class="simplified-clinical-data">

    <!-- Custom CSS for Easy Styling -->
    <style>
        .simplified-clinical-data .clinical-section-card {
            margin-bottom: 1.5rem;
            border: 1px solid #dee2e6;
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .simplified-clinical-data .section-header {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            padding: 1rem;
            margin: 0;
        }

        .simplified-clinical-data .section-body {
            padding: 1.5rem;
        }

        .simplified-clinical-data .clinical-entry {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 0.25rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .simplified-clinical-data .field-label {
            font-weight: 600;
            color: #495057;
            font-size: 0.9rem;
            display: block;
            margin-bottom: 0.25rem;
        }

        .simplified-clinical-data .field-value {
            color: #212529;
            font-size: 1rem;
        }

        .simplified-clinical-data .code-value {
            font-family: 'Courier New', monospace;
            background: #e9ecef;
            padding: 0.2rem 0.4rem;
            border-radius: 0.25rem;
            font-size: 0.9rem;
        }

        .simplified-clinical-data .status-badge {
            padding: 0.3rem 0.6rem;
            border-radius: 1rem;
            font-size: 0.8rem;
            font-weight: 500;
        }

        /* Easy Color Customization */
        .problems-section .section-header { background: linear-gradient(135deg, #dc3545, #b21e2d); }
        .medications-section .section-header { background: linear-gradient(135deg, #28a745, #1e7e34); }
        .allergies-section .section-header { background: linear-gradient(135deg, #ffc107, #d39e00); }
        .vitals-section .section-header { background: linear-gradient(135deg, #17a2b8, #138496); }
        .procedures-section .section-header { background: linear-gradient(135deg, #6f42c1, #5a32a3); }
    </style>

    {% if simplified_data.success %}

    <!-- Info Alert - Easy to customize or remove -->
    <div class="alert alert-info mb-4" id="simplified-info-alert">
        <div class="d-flex align-items-center">
            <i class="fa-solid fa-lightbulb me-2 fs-4"></i>
            <div>
                <h5 class="alert-heading mb-1">Simplified Clinical Data View</h5>
                <p class="mb-0">This flexible view shows clean, accessible clinical data that you can easily customize and restructure.</p>
            </div>
        </div>
    </div>

    <!-- Clinical Sections - Modular and Customizable -->
    {% for section in simplified_data.sections %}
    <div class="clinical-section-card {{ section.type }}-section" id="section-{{ section.type }}">

        <!-- Section Header - Easy to modify -->
        <div class="section-header">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h4 class="mb-0">
                        <i class="fa-solid fa-{{ section.icon|default:'stethoscope' }} me-2"></i>
                        {{ section.title }}
                    </h4>
                    <small class="opacity-75">{{ section.entries|length }} entries â€¢ {{ section.type|title }}</small>
                </div>
                <div>
                    <span class="badge bg-light text-dark">{{ section.section_code }}</span>
                </div>
            </div>
        </div>

        <div class="section-body">
            {% if section.type == "problems" %}
                <!-- PROBLEMS SECTION - Customizable Layout -->
                {% include 'patient_data/sections/simplified_parts/problems_section.html' with entries=section.entries %}

            {% elif section.type == "medications" %}
                <!-- MEDICATIONS SECTION - Customizable Layout -->
                {% include 'patient_data/sections/simplified_parts/medications_section.html' with entries=section.entries %}

            {% elif section.type == "allergies" %}
                <!-- ALLERGIES SECTION - Customizable Layout -->
                {% include 'patient_data/sections/simplified_parts/allergies_section.html' with entries=section.entries %}

            {% elif section.type == "vitals" %}
                <!-- VITAL SIGNS SECTION - Customizable Layout -->
                {% include 'patient_data/sections/simplified_parts/vitals_section.html' with entries=section.entries %}

            {% elif section.type == "procedures" %}
                <!-- PROCEDURES SECTION - Customizable Layout -->
                {% include 'patient_data/sections/simplified_parts/procedures_section.html' with entries=section.entries %}

            {% else %}
                <!-- GENERIC SECTION - Fallback customizable layout -->
                {% include 'patient_data/sections/simplified_parts/generic_section.html' with entries=section.entries section_type=section.type %}

            {% endif %}
        </div>
    </div>
    {% endfor %}

    <!-- Customization Instructions -->
    <div class="customization-guide mt-5">
        <div class="card border-info">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">
                    <i class="fa-solid fa-tools me-2"></i>
                    Easy Customization Guide
                </h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h6 class="text-primary">Styling & Colors:</h6>
                        <ul class="small">
                            <li>Modify CSS in the &lt;style&gt; section above</li>
                            <li>Change section colors by updating .section-header backgrounds</li>
                            <li>Customize .clinical-entry styling for data presentation</li>
                            <li>Use Bootstrap utility classes for quick changes</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-primary">Layout & Structure:</h6>
                        <ul class="small">
                            <li>Modify individual section templates in simplified_parts/</li>
                            <li>Reorder data fields by changing template structure</li>
                            <li>Add/remove fields by editing the entry display logic</li>
                            <li>Switch to table, grid, or card layouts easily</li>
                        </ul>
                    </div>
                </div>

                <div class="mt-3">
                    <h6 class="text-primary">Quick Modifications:</h6>
                    <div class="row">
                        <div class="col-md-4">
                            <small>
                                <strong>Hide Info Alert:</strong><br>
                                Remove or comment out #simplified-info-alert
                            </small>
                        </div>
                        <div class="col-md-4">
                            <small>
                                <strong>Change Section Order:</strong><br>
                                Reorder the section type conditions in the template
                            </small>
                        </div>
                        <div class="col-md-4">
                            <small>
                                <strong>Custom Icons:</strong><br>
                                Update section.icon values in Python data
                            </small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% else %}
        <!-- Error State - Customizable -->
        <div class="alert alert-danger">
            <div class="d-flex align-items-center">
                <i class="fa-solid fa-exclamation-circle me-2 fs-4"></i>
                <div>
                    <h5 class="alert-heading mb-1">Clinical Data Not Available</h5>
                    <p class="mb-0">{{ simplified_data.error|default:"Unable to load simplified clinical data for this patient." }}</p>
                </div>
            </div>
        </div>
    {% endif %}
</div>
