{# Clinical Section Router Template - Routes to appropriate child template based on section type #}

{# Define section type mappings from ps.xsl clinical sections #}
{% set section_templates = {
'psAllergiesAndOtherAdverseReactions': 'patient_data/sections/allergies_section.html',
'allergies': 'patient_data/sections/allergies_section.html',
'allergies_and_intolerances': 'patient_data/sections/allergies_section.html',

'psActiveProblems': 'patient_data/sections/problems_section.html',
'active_problems': 'patient_data/sections/problems_section.html',
'problems': 'patient_data/sections/problems_section.html',
'conditions': 'patient_data/sections/problems_section.html',

'psMedicationSummary': 'patient_data/sections/medication_section.html',
'medication_summary': 'patient_data/sections/medication_section.html',
'medications': 'patient_data/sections/medication_section.html',

'psCodedResults': 'patient_data/sections/lab_results_section.html',
'coded_results': 'patient_data/sections/lab_results_section.html',
'laboratory_results': 'patient_data/sections/lab_results_section.html',
'lab_results': 'patient_data/sections/lab_results_section.html',
'results': 'patient_data/sections/lab_results_section.html',

'psImmunizations': 'patient_data/sections/immunizations_section.html',
'immunizations': 'patient_data/sections/immunizations_section.html',
'vaccinations': 'patient_data/sections/immunizations_section.html',

'psListOfSurgeries': 'patient_data/sections/surgeries_section.html',
'list_of_surgeries': 'patient_data/sections/surgeries_section.html',
'surgeries': 'patient_data/sections/surgeries_section.html',
'surgical_procedures': 'patient_data/sections/surgeries_section.html',
'procedures': 'patient_data/sections/surgeries_section.html',

'psVitalSigns': 'patient_data/sections/vital_signs_section.html',
'vital_signs': 'patient_data/sections/vital_signs_section.html',
'vitals': 'patient_data/sections/vital_signs_section.html',

'psMedicalDevices': 'patient_data/sections/medical_devices_section.html',
'medical_devices': 'patient_data/sections/medical_devices_section.html',
'devices': 'patient_data/sections/medical_devices_section.html',
} %}

{# Define generic section configurations for other section types #}
{% set generic_sections = {
'psHistoryOfPastIllnesses': {
'section_id': 'past_illnesses',
'icon': 'fa-solid fa-history',
'header_class': 'bg-warning text-dark',
'table_header_class': 'table-warning',
'text_class': 'text-warning',
'badge_class': 'bg-warning text-dark',
'border_class': 'border-warning',
'entries_label': 'past illnesses',
'empty_title': 'No Past Illness History',
'empty_message': 'No history of past illnesses reported for this patient'
},
'psHealthMaintenanceCarePlan': {
'section_id': 'health_maintenance',
'icon': 'fa-solid fa-heart',
'header_class': 'bg-success',
'table_header_class': 'table-success',
'text_class': 'text-success',
'badge_class': 'bg-success',
'border_class': 'border-success',
'entries_label': 'care plans',
'empty_title': 'No Health Maintenance Plan',
'empty_message': 'No health maintenance care plan available for this patient'
},
'psFunctionalStatus': {
'section_id': 'functional_status',
'icon': 'fa-solid fa-wheelchair',
'header_class': 'bg-info',
'table_header_class': 'table-info',
'text_class': 'text-info',
'badge_class': 'bg-info',
'border_class': 'border-info',
'entries_label': 'functional assessments',
'empty_title': 'No Functional Status Data',
'empty_message': 'No functional status information available for this patient'
},
'psSocialHistory': {
'section_id': 'social_history',
'icon': 'fa-solid fa-users',
'header_class': 'bg-primary',
'table_header_class': 'table-primary',
'text_class': 'text-primary',
'badge_class': 'bg-primary',
'border_class': 'border-primary',
'entries_label': 'social factors',
'empty_title': 'No Social History',
'empty_message': 'No social history information available for this patient'
},
'psPregnancyHistory': {
'section_id': 'pregnancy_history',
'icon': 'fa-solid fa-baby',
'header_class': 'bg-danger',
'table_header_class': 'table-danger',
'text_class': 'text-danger',
'badge_class': 'bg-danger',
'border_class': 'border-danger',
'entries_label': 'pregnancies',
'empty_title': 'No Pregnancy History',
'empty_message': 'No pregnancy history available for this patient'
},
'psAdvanceDirectives': {
'section_id': 'advance_directives',
'icon': 'fa-solid fa-file-contract',
'header_class': 'bg-dark',
'table_header_class': 'table-dark',
'text_class': 'text-dark',
'badge_class': 'bg-dark',
'border_class': 'border-dark',
'entries_label': 'directives',
'empty_title': 'No Advance Directives',
'empty_message': 'No advance directives on file for this patient'
}
} %}

{# Determine section type and routing #}
{% set section_type = section.section_type or section.template_name or 'generic' %}
{% set section_key = section_type.lower() %}

{# Route to specific template if available #}
{% if section_key in section_templates %}
{% include section_templates[section_key] %}
{% elif section_key in generic_sections %}
{# Use generic template with section configuration passed as context #}
{% set generic_config = generic_sections[section_key] %}
{% include 'patient_data/sections/generic_clinical_section.html' %}
{% else %}
{# Fallback to generic template with default styling #}
{% set generic_config = {} %}
{% include 'patient_data/sections/generic_clinical_section.html' %}
{% endif %}

{# Section Debug Info (Collapsed by default) - Preserved from original template #}
{% if section %}
<div class="mt-2 mb-2">
    <div class="card">
        <div class="card-footer">
            <button class="btn btn-outline-secondary btn-sm" type="button" data-bs-toggle="collapse"
                data-bs-target="#debug-{{ loop.index }}" aria-expanded="false" aria-controls="debug-{{ loop.index }}">
                <i class="fa-solid fa-bug me-1"></i>Show Section Debug Info
            </button>
            <div class="collapse mt-2" id="debug-{{ loop.index }}">
                <div class="p-2 bg-light border rounded small">
                    <strong>Section Debug ({{ section.title|default:"Unknown" }}):</strong>
                    <ul class="mb-0 small">
                        {% for key, value in section.items() %}
                        <li>{{ key }}: {{ value }}</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif %}