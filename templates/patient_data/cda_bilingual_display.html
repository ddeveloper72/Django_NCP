{% extends "base.html" %}

{% block title %}CDA Document Translation - {{ country_code }}{% endblock %}

{% block extra_css %}
<!-- CDA bilingual display styles are now externalized to _cda_bilingual.scss -->
{% endblock %}

{% block content %}
<div class="cda-container">
    <!-- Header -->
    <div class="cda-header">
        <h1>Clinical Document Architecture Translation</h1>
        <div>
            <strong>Country:</strong> {{ country_code }}
            {% if patient_id %}
            | <strong>Patient ID:</strong> {{ patient_id }}
            {% endif %}
        </div>
        <div class="language-indicator">
            Original Language: {{ source_language|upper }} â†’ English Translation
        </div>
    </div>

    <!-- Translation Controls -->
    <div class="translation-controls">
        <div>
            <strong>View Mode:</strong>
        </div>
        <div class="view-toggle">
            <button class="toggle-btn active" onclick="showBilingual()">Side-by-Side</button>
            <button class="toggle-btn" onclick="showOriginal()">Original Only</button>
            <button class="toggle-btn" onclick="showTranslated()">English Only</button>
        </div>
    </div>

    <!-- Patient Information -->
    {% if patient_info %}
    <div class="patient-info-section">
        <h2>Patient Information</h2>
        <div class="patient-info-grid">
            <div class="patient-info-column">
                <h3>Original ({{ source_language|upper }})</h3>
                {% for key, data in patient_info.items %}
                <div class="patient-field">
                    <div class="field-label">{{ data.key_original }}</div>
                    <div class="field-value">{{ data.original }}</div>
                </div>
                {% endfor %}
            </div>
            <div class="patient-info-column">
                <h3>English Translation</h3>
                {% for key, data in patient_info.items %}
                <div class="patient-field">
                    <div class="field-label">{{ data.key_translated }}</div>
                    <div class="field-value">{{ data.translated }}</div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Medical Sections -->
    <div class="bilingual-sections" id="bilingual-container">
        <!-- Original Language Column -->
        <div class="section-column original-column">
            <div class="section-column-header">
                Original Document ({{ source_language|upper }})
            </div>
            <div class="section-content">
                {% for section in sections %}
                <div class="medical-section">
                    <h3 class="section-title">{{ section.title_original }}</h3>
                    <div class="section-body">
                        {% if section.tables %}
                        {% for table in section.tables %}
                        <table class="medical-table">
                            <thead>
                                <tr>
                                    {% for header in table.headers_original %}
                                    <th>{{ header }}</th>
                                    {% endfor %}
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in table.rows %}
                                <tr>
                                    {% for cell in row %}
                                    <td>{{ cell }}</td>
                                    {% endfor %}
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% endfor %}
                        {% endif %}

                        {% if section.content_original %}
                        <div class="section-text">
                            {{ section.content_original|linebreaks }}
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- English Translation Column -->
        <div class="section-column translated-column">
            <div class="section-column-header">
                English Translation
            </div>
            <div class="section-content">
                {% for section in sections %}
                <div class="medical-section">
                    <h3 class="section-title">{{ section.title_translated }}</h3>
                    <div class="section-body">
                        {% if section.tables %}
                        {% for table in section.tables %}
                        <table class="medical-table">
                            <thead>
                                <tr>
                                    {% for header in table.headers_translated %}
                                    <th>{{ header }}</th>
                                    {% endfor %}
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in table.rows %}
                                <tr>
                                    {% for cell in row %}
                                    <td>{{ cell }}</td>
                                    {% endfor %}
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {% endfor %}
                        {% endif %}

                        {% if section.content_translated %}
                        <div class="section-text">
                            {{ section.content_translated|linebreaks }}
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

{% block extra_js %}
<!-- CDA bilingual functionality is now externalized -->
<script src="{% static 'js/patient_forms.js' %}"></script>
{% endblock %}
