{% extends "base.html" %}
{% load static %}

{% block title %}Test CDA Display - Django Syntax Test{% endblock %}

{% block extra_css %}
<style>
    .test-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
    }
    .test-success {
        background: #d4edda;
        border: 1px solid #c3e6cb;
        color: #155724;
        padding: 1rem;
        border-radius: 0.375rem;
        margin: 1rem 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="test-container">
    <h1>üß™ Django Template Syntax Test</h1>

    <div class="test-success">
        <h4>‚úÖ Template Loading Successfully</h4>
        <p>This template is using pure Django syntax and loading without errors.</p>
    </div>

    <!-- Test basic Django template features -->
    {% if patient_identity %}
        <h3>Patient Information Available</h3>
        <p><strong>Patient ID:</strong> {{ patient_identity.patient_id|default:"Not available" }}</p>
        <p><strong>Given Name:</strong> {{ patient_identity.given_name|default:"Not available" }}</p>
        <p><strong>Family Name:</strong> {{ patient_identity.family_name|default:"Not available" }}</p>
        <p><strong>Gender:</strong> {{ patient_identity.gender|default:"Not specified" }}</p>
    {% else %}
        <div class="alert alert-warning">
            <p>No patient identity data available for testing.</p>
        </div>
    {% endif %}

    <!-- Test administrative data -->
    {% if administrative_data %}
        <h3>Administrative Data Available</h3>
        <p>‚úÖ Administrative data is present in context</p>

        <!-- Test Django-compatible syntax -->
        {% if administrative_data.authors %}
            <p><strong>Authors Count:</strong> {{ administrative_data.authors|length }}</p>
        {% endif %}

        {% if administrative_data.custodians %}
            <p><strong>Custodians Count:</strong> {{ administrative_data.custodians|length }}</p>
        {% endif %}

    {% else %}
        <div class="alert alert-info">
            <p>No administrative data available for testing.</p>
        </div>
    {% endif %}

    <!-- Test clinical sections -->
    {% if clinical_sections_list %}
        <h3>Clinical Sections Available</h3>
        <p><strong>Total Sections:</strong> {{ clinical_sections_list|length }}</p>

        {% for section in clinical_sections_list %}
            {% if forloop.counter <= 3 %}
                <div class="card mb-2">
                    <div class="card-body">
                        <h6>{{ section.section_title|default:"Untitled Section" }}</h6>
                        <p><strong>Section ID:</strong> {{ section.section_id|default:"Unknown" }}</p>
                        {% if section.entries %}
                            <p><strong>Entries:</strong> {{ section.entries|length }}</p>
                        {% endif %}
                    </div>
                </div>
            {% endif %}
        {% endfor %}

        {% if clinical_sections_list|length > 3 %}
            <p><em>... and {{ clinical_sections_list|length|add:"-3" }} more sections</em></p>
        {% endif %}
    {% else %}
        <div class="alert alert-info">
            <p>No clinical sections available for testing.</p>
        </div>
    {% endif %}

    <hr>
    <div class="test-success">
        <h4>üéâ Django Template Syntax Validation Complete</h4>
        <p>If you can see this page, the basic Django template syntax is working correctly!</p>
        <p><strong>Next Step:</strong> Debug any remaining component template issues</p>
    </div>

    <p><a href="{% url 'patient_data:patient_data_form' %}" class="btn btn-primary">‚Üê Back to Patient Search</a></p>
</div>
{% endblock %}
