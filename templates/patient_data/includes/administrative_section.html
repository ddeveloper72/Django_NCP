{% comment %}
Administrative Information Section for CDA Patient Display
Displays comprehensive administrative contacts including participants (emergency contacts, next of kin, PCPs)
{% endcomment %}

{% load static %}

{% if administrative_data and has_administrative_data %}
<div class="wrap-collapsible">
    <input id="collapsible-administrative" class="toggle" type="checkbox" checked>
    <label for="collapsible-administrative" class="lbl-toggle-main">
        <i class="fas fa-users"></i> Administrative Information
        <span class="indicator">
            {% if administrative_data.other_contacts %}
            {{ administrative_data.other_contacts|length }} Contact{{
            administrative_data.other_contacts|length|pluralize }}
            {% endif %}
        </span>
    </label>
    <div class="collapsible-content-main">
        <div class="content-inner">

            {% comment %} Patient Contact Information {% endcomment %}
            {% if administrative_data.patient_contact_info and (administrative_data.patient_contact_info.addresses or
            administrative_data.patient_contact_info.telecoms) %}
            <div class="admin-section">
                <h4 class="admin-section-title">
                    <i class="fas fa-user"></i> Patient Contact Information
                </h4>
                <div class="contact-card patient-contact">
                    {% if administrative_data.patient_contact_info.addresses %}
                    {% for address in administrative_data.patient_contact_info.addresses %}
                    <div class="contact-detail">
                        <i class="fas fa-map-marker-alt"></i>
                        <strong>Address:</strong>
                        {% if address.street %}{{ address.street }}{% endif %}
                        {% if address.city %}, {{ address.city }}{% endif %}
                        {% if address.postalCode %} {{ address.postalCode }}{% endif %}
                        {% if address.country %}, {{ address.country }}{% endif %}
                    </div>
                    {% endfor %}
                    {% endif %}

                    {% if administrative_data.patient_contact_info.telecoms %}
                    {% for telecom in administrative_data.patient_contact_info.telecoms %}
                    <div class="contact-detail">
                        {% if telecom.type == 'email' %}
                        <i class="fas fa-envelope"></i>
                        <strong>Email:</strong> {{ telecom.value|replace:"mailto:",'' }}
                        {% elif telecom.type == 'phone' %}
                        <i class="fas fa-phone"></i>
                        <strong>Phone:</strong> {{ telecom.value|replace:"tel:",'' }}
                        {% else %}
                        <i class="fas fa-info-circle"></i>
                        <strong>{{ telecom.type|title }}:</strong> {{ telecom.value }}
                        {% endif %}
                    </div>
                    {% endfor %}
                    {% endif %}
                </div>
            </div>
            {% endif %}

            {% comment %} Authors Information {% endcomment %}
            {% if administrative_data.author_information %}
            <div class="admin-section">
                <h4 class="admin-section-title">
                    <i class="fas fa-user-md"></i> Document Authors
                </h4>
                {% for author in administrative_data.author_information %}
                <div class="contact-card author-contact">
                    {% if author.person.full_name %}
                    <div class="contact-name">
                        <strong>{{ author.person.full_name }}</strong>
                        {% if author.person.role %}
                        <span class="role-badge">{{ author.person.role }}</span>
                        {% endif %}
                    </div>
                    {% endif %}

                    {% if author.organization.name %}
                    <div class="contact-detail">
                        <i class="fas fa-building"></i>
                        <strong>Organization:</strong> {{ author.organization.name }}
                    </div>
                    {% endif %}

                    {% if author.organization.addresses %}
                    {% for address in author.organization.addresses %}
                    <div class="contact-detail">
                        <i class="fas fa-map-marker-alt"></i>
                        <strong>Address:</strong>
                        {% if address.street %}{{ address.street }}{% endif %}
                        {% if address.city %}, {{ address.city }}{% endif %}
                        {% if address.postalCode %} {{ address.postalCode }}{% endif %}
                        {% if address.country %}, {{ address.country }}{% endif %}
                    </div>
                    {% endfor %}
                    {% endif %}

                    {% if author.organization.telecoms %}
                    {% for telecom in author.organization.telecoms %}
                    <div class="contact-detail">
                        {% if telecom.type == 'email' %}
                        <i class="fas fa-envelope"></i>
                        <strong>Email:</strong> {{ telecom.value|replace:"mailto:",'' }}
                        {% elif telecom.type == 'phone' %}
                        <i class="fas fa-phone"></i>
                        <strong>Phone:</strong> {{ telecom.value|replace:"tel:",'' }}
                        {% else %}
                        <i class="fas fa-info-circle"></i>
                        <strong>{{ telecom.type|title }}:</strong> {{ telecom.value }}
                        {% endif %}
                    </div>
                    {% endfor %}
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% endif %}

            {% comment %} Legal Authenticator {% endcomment %}
            {% if administrative_data.legal_authenticator and administrative_data.legal_authenticator.full_name %}
            <div class="admin-section">
                <h4 class="admin-section-title">
                    <i class="fas fa-certificate"></i> Legal Authenticator
                </h4>
                <div class="contact-card legal-auth-contact">
                    <div class="contact-name">
                        <strong>{{ administrative_data.legal_authenticator.full_name }}</strong>
                        {% if administrative_data.legal_authenticator.title %}
                        <span class="role-badge legal-authenticator">{{ administrative_data.legal_authenticator.title }}</span>
                        {% endif %}
                    </div>

                    {% if administrative_data.legal_authenticator.organization.name %}
                    <div class="contact-detail">
                        <i class="fas fa-building"></i>
                        <strong>Organization:</strong> {{ administrative_data.legal_authenticator.organization.name }}
                    </div>
                    {% endif %}

                    {% if administrative_data.legal_authenticator.organization.addresses %}
                    {% for address in administrative_data.legal_authenticator.organization.addresses %}
                    <div class="contact-detail">
                        <i class="fas fa-map-marker-alt"></i>
                        <strong>Address:</strong>
                        {% if address.street %}{{ address.street }}{% endif %}
                        {% if address.city %}, {{ address.city }}{% endif %}
                        {% if address.postalCode %} {{ address.postalCode }}{% endif %}
                        {% if address.country %}, {{ address.country }}{% endif %}
                    </div>
                    {% endfor %}
                    {% endif %}

                    {% if administrative_data.legal_authenticator.organization.telecoms %}
                    {% for telecom in administrative_data.legal_authenticator.organization.telecoms %}
                    <div class="contact-detail">
                        {% if telecom.type == 'email' %}
                        <i class="fas fa-envelope"></i>
                        <strong>Email:</strong> {{ telecom.value|replace:"mailto:",'' }}
                        {% elif telecom.type == 'phone' %}
                        <i class="fas fa-phone"></i>
                        <strong>Phone:</strong> {{ telecom.value|replace:"tel:",'' }}
                        {% else %}
                        <i class="fas fa-info-circle"></i>
                        <strong>{{ telecom.type|title }}:</strong> {{ telecom.value }}
                        {% endif %}
                    </div>
                    {% endfor %}
                    {% endif %}
                </div>
            </div>
            {% endif %}

            {% comment %} Custodian Organization {% endcomment %}
            {% if administrative_data.custodian_organization and administrative_data.custodian_organization.name %}
            <div class="admin-section">
                <h4 class="admin-section-title">
                    <i class="fas fa-university"></i> Custodian Organization
                </h4>
                <div class="contact-card custodian-contact">
                    <div class="contact-name">
                        <strong>{{ administrative_data.custodian_organization.name }}</strong>
                    </div>

                    {% if administrative_data.custodian_organization.addresses %}
                    {% for address in administrative_data.custodian_organization.addresses %}
                    <div class="contact-detail">
                        <i class="fas fa-map-marker-alt"></i>
                        <strong>Address:</strong>
                        {% if address.street %}{{ address.street }}{% endif %}
                        {% if address.city %}, {{ address.city }}{% endif %}
                        {% if address.postalCode %} {{ address.postalCode }}{% endif %}
                        {% if address.country %}, {{ address.country }}{% endif %}
                    </div>
                    {% endfor %}
                    {% endif %}

                    {% if administrative_data.custodian_organization.telecoms %}
                    {% for telecom in administrative_data.custodian_organization.telecoms %}
                    <div class="contact-detail">
                        {% if telecom.type == 'email' %}
                        <i class="fas fa-envelope"></i>
                        <strong>Email:</strong> {{ telecom.value|replace:"mailto:",'' }}
                        {% elif telecom.type == 'phone' %}
                        <i class="fas fa-phone"></i>
                        <strong>Phone:</strong> {{ telecom.value|replace:"tel:",'' }}
                        {% else %}
                        <i class="fas fa-info-circle"></i>
                        <strong>{{ telecom.type|title }}:</strong> {{ telecom.value }}
                        {% endif %}
                    </div>
                    {% endfor %}
                    {% endif %}
                </div>
            </div>
            {% endif %}

            {% comment %} Participants (Emergency Contacts, Next of Kin, PCPs) {% endcomment %}
            {% if administrative_data.other_contacts %}
            <div class="admin-section">
                <h4 class="admin-section-title">
                    <i class="fas fa-users"></i> Additional Contacts
                    <span class="contact-count">({{ administrative_data.other_contacts|length }})</span>
                </h4>

                {% for contact in administrative_data.other_contacts %}
                <div class="contact-card participant-contact">
                    {% if contact.full_name %}
                    <div class="contact-name">
                        <strong>{{ contact.full_name }}</strong>
                        {% if contact.role %}
                        <span class="role-badge {{ contact.role|lower|slugify }}">{{ contact.role }}</span>
                        {% endif %}
                    </div>
                    {% endif %}

                    {% if contact.specialty %}
                    <div class="contact-detail">
                        <i class="fas fa-calendar"></i>
                        <strong>Period:</strong> {{ contact.specialty }}
                    </div>
                    {% endif %}

                    {% if contact.organization.name %}
                    <div class="contact-detail">
                        <i class="fas fa-building"></i>
                        <strong>Organization:</strong> {{ contact.organization.name }}
                    </div>
                    {% endif %}

                    {% if contact.contact_info.addresses %}
                    {% for address in contact.contact_info.addresses %}
                    <div class="contact-detail">
                        <i class="fas fa-map-marker-alt"></i>
                        <strong>Address:</strong>
                        {% if address.street %}{{ address.street }}{% endif %}
                        {% if address.city %}, {{ address.city }}{% endif %}
                        {% if address.postalCode %} {{ address.postalCode }}{% endif %}
                        {% if address.country %}, {{ address.country }}{% endif %}
                    </div>
                    {% endfor %}
                    {% endif %}

                    {% if contact.contact_info.telecoms %}
                    {% for telecom in contact.contact_info.telecoms %}
                    <div class="contact-detail">
                        {% if telecom.type == 'email' %}
                        <i class="fas fa-envelope"></i>
                        <strong>Email:</strong> {{ telecom.value|replace:"mailto:",'' }}
                        {% elif telecom.type == 'phone' %}
                        <i class="fas fa-phone"></i>
                        <strong>Phone:</strong> {{ telecom.value|replace:"tel:",'' }}
                        {% else %}
                        <i class="fas fa-info-circle"></i>
                        <strong>{{ telecom.type|title }}:</strong> {{ telecom.value }}
                        {% endif %}
                    </div>
                    {% endfor %}
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% endif %}

        </div>
    </div>
</div>

{% endif %}