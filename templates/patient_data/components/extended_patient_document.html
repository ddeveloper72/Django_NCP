{% load patient_filters %}

<!-- Extended Patient Document Information Component -->
<div class="d-flex align-items-center justify-content-between mb-3">
  <h5 class="mb-0"><i class="fas fa-file-medical-alt me-2"></i>Document Information</h5>
  <span class="badge bg-info">
    Patient Summary (PS) - European eHealth Standard
  </span>
</div>

<!-- Document Metadata Card -->
<div class="card document-info-card mb-4">
    <div class="card-header bg-info text-white">
        <h6 class="mb-0">
            <i class="fas fa-file-medical me-2"></i>
            CDA Document Metadata
        </h6>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <!-- Document Status -->
                <div class="mb-3">
                    <h6 class="text-muted"><i class="fas fa-info-circle me-1"></i>Document Status</h6>
                    <div class="mb-2">
                        <span class="badge bg-success me-2"><i class="fas fa-check me-1"></i>Active</span>
                        <span class="badge bg-info me-2"><i class="fas fa-lock me-1"></i>Secure</span>
                        <span class="badge bg-secondary"><i class="fas fa-eye me-1"></i>Normal Confidentiality</span>
                    </div>
                    <small class="text-muted">Document confidentialityCode and status indicators</small>
                </div>

                <!-- Document Dates -->
                {% if administrative_data %}
                    {% if administrative_data.document_creation_time %}
                        <div class="mb-3">
                            <h6 class="text-muted"><i class="fas fa-calendar-plus me-1"></i>Creation Date</h6>
                            <p class="mb-0">{{ administrative_data.document_creation_time }}</p>
                        </div>
                    {% endif %}

                    {% if administrative_data.last_modified_time and administrative_data.last_modified_time != 'Unknown' %}
                        <div class="mb-3">
                            <h6 class="text-muted"><i class="fas fa-calendar-check me-1"></i>Last Updated</h6>
                            <p class="mb-0">{{ administrative_data.last_modified_time }}</p>
                        </div>
                    {% endif %}

                    {% if administrative_data.document_version %}
                        <div class="mb-3">
                            <h6 class="text-muted"><i class="fas fa-code-branch me-1"></i>Version</h6>
                            <p class="mb-0">{{ administrative_data.document_version }}</p>
                        </div>
                    {% endif %}
                {% endif %}
            </div>

            <div class="col-md-6">
                <!-- Document Identifiers -->
                {% if administrative_data %}
                    {% if administrative_data.document_version_number %}
                        <div class="mb-3">
                            <h6 class="text-muted"><i class="fas fa-code-branch me-1"></i>Version</h6>
                            <p class="mb-0">
                                <span class="badge bg-primary">v{{ administrative_data.document_version_number }}</span>
                            </p>
                        </div>
                    {% endif %}

                    {% if administrative_data.document_set_id %}
                        <div class="mb-3">
                            <h6 class="text-muted"><i class="fas fa-barcode me-1"></i>Document Set ID</h6>
                            <p class="mb-0">
                                <code class="text-muted">{{ administrative_data.document_set_id }}</code>
                            </p>
                        </div>
                    {% endif %}

                    {% if administrative_data.document_id %}
                        <div class="mb-3">
                            <h6 class="text-muted"><i class="fas fa-fingerprint me-1"></i>Document ID</h6>
                            <p class="mb-0">
                                <code class="text-muted">{{ administrative_data.document_id|truncatechars:40 }}</code>
                            </p>
                        </div>
                    {% endif %}
                {% endif %}

                <!-- Document Type Info -->
                <div class="mb-3">
                    <h6 class="text-muted"><i class="fas fa-file-alt me-1"></i>Document Type</h6>
                    <p class="mb-0">Patient Summary (PS) - European eHealth Standard</p>
                    <small class="text-muted">HL7 CDA R2 Implementation Guide</small>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Custodian Organization Card -->
{% if administrative_data and administrative_data.custodian_organization %}
    {% with custodian=administrative_data.custodian_organization %}
        <div class="card document-info-card mb-4">
            <div class="card-header bg-warning text-dark">
                <h6 class="mb-0">
                    <i class="fas fa-shield-alt me-2"></i>
                    Document Custodian
                    <span class="badge bg-dark text-white ms-2">Legal Responsibility</span>
                </h6>
            </div>
            <div class="card-body">
                <h6 class="card-title text-warning">
                    {{ custodian.name|default:"Document Custodian Organization" }}
                </h6>
                {% if custodian.organization_type %}
                    <p class="mb-3">
                        <span class="badge bg-warning text-dark">{{ custodian.organization_type }}</span>
                    </p>
                {% endif %}
                {% if custodian.id %}
                    <p class="mb-0">
                        <small class="text-muted">Organization ID: {{ custodian.id|truncatechars:30 }}</small>
                    </p>
                {% endif %}
            </div>
        </div>
    {% endwith %}
{% endif %}

<!-- Document Summary -->
{% if administrative_data %}
    <div class="card document-info-card">
        <div class="card-header bg-secondary text-white">
            <h6 class="mb-0">
                <i class="fas fa-file-medical me-2"></i>
                Document Summary
            </h6>
        </div>
        <div class="card-body">
            <p class="mb-0">
                This European Patient Summary document contains essential health information extracted from 
                healthcare systems to support continuity of care. The document follows HL7 CDA R2 
                implementation guidelines and European eHealth interoperability standards.
            </p>
        </div>
    </div>
{% else %}
    <!-- Fallback content when no document data is available -->
    <div class="alert alert-info">
        <div class="d-flex align-items-center">
            <i class="fas fa-info-circle fa-2x me-3"></i>
            <div>
                <h6 class="mb-1">Limited Document Information</h6>
                <p class="mb-0">Document metadata is not available or has not been extracted from the current CDA document.</p>
            </div>
        </div>
    </div>
{% endif %}

<!-- Fallback content when no document data is available -->
{% if not document_data or not document_data.document_creation_date and not document_data.custodian_organization %}
<div class="alert alert-info">
    <div class="d-flex align-items-center">
        <i class="fas fa-info-circle fa-2x me-3"></i>
        <div>
            <h6 class="mb-1">Limited Document Information</h6>
            <p class="mb-0">Document metadata is not available or has not been extracted from the current CDA document.</p>
        </div>
    </div>
</div>
{% endif %}

<!-- No Document Information Message -->
{% if not document_data %}
    <div class="empty-state text-center py-4">
        <i class="fas fa-file-medical fa-3x text-muted mb-3"></i>
        <h6>No Document Information</h6>
        <p class="text-muted">No document metadata is available.</p>
    </div>
{% endif %}

</div>
