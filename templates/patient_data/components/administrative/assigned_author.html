{# CDA assignedAuthor - Document Author Component #}
{# Expected context: author_hcp (DotDict with flattened person fields + nested organization) #}

{% if author_hcp %}
<div class="assigned-author-section bg-white border rounded-3 shadow-sm overflow-hidden mb-3">
    <div class="table-responsive">
        <table class="table table-bordered mb-0">
            <tbody>
                {# Author Row #}
                <tr>
                    <td class="table-light fw-bold" style="width: 20%;">Author</td>
                    <td style="width: 40%;">
                        <div class="d-flex align-items-start">
                            <i class="fa-solid fa-user-doctor me-2 text-primary mt-1"></i>
                            <div>
                                <strong>{{ author_hcp.full_name|default:"Unknown Practitioner" }}</strong>
                                {% if author_hcp.role %}
                                    <span class="text-muted">- Code:</span> <span class="badge bg-primary ms-1">{{ author_hcp.role }}</span>
                                {% endif %}
                                {% if author_hcp.specialty %}
                                    <span class="badge bg-info ms-1">{{ author_hcp.specialty }}</span>
                                {% endif %}
                                {% if author_hcp.organization %}
                                <div class="text-muted small mt-1">
                                    <i class="fa-solid fa-building me-1"></i>
                                    Organization: {% if author_hcp.organization.name %}{{ author_hcp.organization.name }}{% else %}{{ author_hcp.organization }}{% endif %}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </td>
                    <td class="table-light fw-bold" style="width: 15%;">Contact Details</td>
                    <td style="width: 25%;">
                        {# Practitioner Contact #}
                        {% if author_hcp.addresses %}
                            {% with address=author_hcp.addresses.0 %}
                            <div class="mb-1 small">
                                {% for line in address.line %}{{ line }}{% if not forloop.last %}, {% endif %}{% endfor %}
                                {% if not address.line and address.street %}{{ address.street }}{% endif %}
                            </div>
                            <div class="mb-1 small">
                                {% if address.city %}{{ address.city }}{% endif %}{% if address.postal_code %} {{ address.postal_code }}{% endif %}
                            </div>
                            <div class="mb-1 small">{% if address.country %}{{ address.country }}{% endif %}</div>
                            {% endwith %}
                        {% endif %}
                        {% if author_hcp.telecoms %}
                            {% for telecom in author_hcp.telecoms %}
                                {% if telecom.system == 'phone' %}
                                <div class="small">Tel {{ telecom.use|title }}: {{ telecom.value }}</div>
                                {% elif telecom.system == 'email' %}
                                <div class="small">Mail: {{ telecom.value }}</div>
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                        {# Organization Contact #}
                        {% if author_hcp.organization.contact %}
                            {% for contact in author_hcp.organization.contact %}
                                {% if contact.address %}
                                <div class="mt-2 pt-2 border-top small text-muted">
                                    <strong>Organization:</strong><br>
                                    {% for line in contact.address.line %}{{ line }}{% if not forloop.last %}, {% endif %}{% endfor %}<br>
                                    {{ contact.address.city }} {{ contact.address.postalCode }}<br>
                                    {{ contact.address.country }}
                                </div>
                                {% endif %}
                                {% if contact.telecom %}
                                    {% for telecom in contact.telecom %}
                                        {% if telecom.system == 'email' %}
                                        <div class="small text-muted">Mail {{ telecom.use|title }}: {{ telecom.value }}</div>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            {% endfor %}
                        {% endif %}
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
{% endif %}
