{# CDA legalAuthenticator - Document Signer Component #}
{# Expected context: legal_authenticator (DotDict with person details and organization) #}

{% if legal_authenticator %}
<div class="legal-authenticator-section bg-white border rounded-3 shadow-sm overflow-hidden mb-3">
    <div class="table-responsive">
        <table class="table table-bordered mb-0">
            <tbody>
                {# Legal Authenticator Row #}
                <tr>
                    <td class="table-light fw-bold" style="width: 20%;">Legal Authenticator</td>
                    <td style="width: 40%;">
                        <div class="d-flex align-items-start">
                            <i class="fa-solid fa-certificate me-2 text-success mt-1"></i>
                            <div>
                                <strong>{{ legal_authenticator.full_name|default:"Unknown" }}</strong>
                                {% if legal_authenticator.organization.name %}
                                    of {{ legal_authenticator.organization.name }}
                                {% endif %}
                                <div class="small text-muted mt-1">
                                    signed at {{ legal_authenticator.timestamp|default:"Unknown date" }}
                                </div>
                            </div>
                        </div>
                    </td>
                    <td class="table-light fw-bold" style="width: 15%;">Contact Details</td>
                    <td style="width: 25%;">
                        {# Address #}
                        {% if legal_authenticator.contact_info.addresses %}
                            {% with address=legal_authenticator.contact_info.addresses.0 %}
                            <div class="mb-1 small">{{ legal_authenticator.organization.workplace|default:"Workplace" }}: {% if address.street %}{{ address.street }}{% endif %}</div>
                            <div class="mb-1 small">{% if address.city %}{{ address.city }}{% endif %}{% if address.postal_code %} {{ address.postal_code }}{% endif %}</div>
                            <div class="mb-1 small">{% if address.country %}{{ address.country }}{% endif %}</div>
                            {% endwith %}
                        {% endif %}
                        {# Telecoms #}
                        {% if legal_authenticator.contact_info.telecoms %}
                            {% regroup legal_authenticator.contact_info.telecoms by value as telecom_groups %}
                            {% for group in telecom_groups %}
                                {% with telecom=group.list.0 %}
                                    {% if 'tel:' in telecom.value %}
                                    <div class="small">Tel Workplace: {{ telecom.value|slice:"4:" }}</div>
                                    {% elif 'mailto:' in telecom.value %}
                                    <div class="small">Mail Workplace: {{ telecom.value|slice:"7:" }}</div>
                                    {% endif %}
                                {% endwith %}
                            {% endfor %}
                        {% endif %}
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
{% endif %}
