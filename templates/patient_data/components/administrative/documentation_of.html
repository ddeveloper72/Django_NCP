{# CDA documentationOf - Service Event with Performers Component (Accordion Design) #}
{# Expected context: documentation_of (DotDict with serviceEvent details and performers) #}

{% if documentation_of %}
<div class="documentation-of-section mb-4">
    <div class="collapsible-wrapper">
        <input id="toggle-documentation-of" class="toggle-input" type="checkbox" checked>
        <label for="toggle-documentation-of" class="collapsible-label-title">
            <div class="clinical-section-title-row">
                <div class="clinical-section-title">
                    <i class="fa-solid fa-file-medical me-2"></i>
                    <span>Documentation Of - Service Event</span>
                </div>
                <div class="clinical-badge-container">
                    <span class="clinical-badge populated">Service Event</span>
                </div>
            </div>
            <i class="fas fa-chevron-down toggle-icon" aria-hidden="true"></i>
        </label>
        <div class="collapsible-content-title">
            <div class="content-inner-title">
            {# SERVICE EVENT DETAILS #}
            {% if documentation_of.effective_time %}
            <div class="service-event-section mb-4 pb-3 border-bottom">
                <h6 class="text-secondary mb-3">
                    <i class="fa-solid fa-calendar-days me-2"></i>
                    Service Event Period
                </h6>
                
                <div class="ms-3">
                    {# Effective Time Period #}
                    {% if documentation_of.effective_time.low %}
                    <div class="mb-2">
                        <strong>
                            <i class="fa-solid fa-calendar-plus me-2 text-success"></i>
                            Start Date:
                        </strong>
                        <span class="ms-2">{{ documentation_of.effective_time.low }}</span>
                    </div>
                    {% endif %}
                    
                    {% if documentation_of.effective_time.high %}
                    <div class="mb-2">
                        <strong>
                            <i class="fa-solid fa-calendar-minus me-2 text-danger"></i>
                            End Date:
                        </strong>
                        <span class="ms-2">{{ documentation_of.effective_time.high }}</span>
                    </div>
                    {% endif %}
                </div>
            </div>
            {% endif %}
            
            {# SERVICE EVENT PERFORMERS #}
            {% if documentation_of.performers %}
                {% for performer in documentation_of.performers %}
                <div class="performer-section mb-4 {% if not forloop.last %}pb-3 border-bottom{% endif %}">
                    <h6 class="text-secondary mb-3">
                        <i class="fa-solid fa-user-doctor me-2"></i>
                        Service Event Performer
                        {% if performer.function_code %}
                            <span class="badge bg-secondary ms-2">{{ performer.function_code }}</span>
                        {% endif %}
                    </h6>
                    
                    {# PERFORMER DETAILS #}
                    {% if performer.full_name %}
                    <div class="ms-3 mb-3">
                        <h5 class="mb-2">
                            <i class="fa-solid fa-user-check me-2 text-secondary"></i>
                            {{ performer.full_name }}
                        </h5>
                        
                        {# Performer Role/Function #}
                        {% if performer.role %}
                        <div class="mb-2">
                            <span class="badge bg-info">{{ performer.role }}</span>
                        </div>
                        {% endif %}
                        
                        {# Performer Time #}
                        {% if performer.time %}
                        <div class="mb-3">
                            <strong class="d-block mb-1">
                                <i class="fa-solid fa-clock me-2 text-secondary"></i>
                                Performance Period:
                            </strong>
                            <div class="ms-3">
                                {% if performer.time.low %}
                                <div class="small">
                                    <strong>From:</strong> {{ performer.time.low }}
                                </div>
                                {% endif %}
                                {% if performer.time.high %}
                                <div class="small">
                                    <strong>To:</strong> {{ performer.time.high }}
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}
                        
                        {# Performer Contact Information #}
                        {% if performer.contact_info %}
                        <div class="mt-3">
                            <strong class="d-block mb-2">
                                <i class="fa-solid fa-address-card me-2 text-secondary"></i>
                                Contact:
                            </strong>
                            
                            {# Performer Address #}
                            {% if performer.contact_info.addresses %}
                                {% for address in performer.contact_info.addresses %}
                                <div class="ms-3 mb-2">
                                    <i class="fa-solid fa-location-dot me-2 text-muted"></i>
                                    {% if address.street %}{{ address.street }}<br>{% endif %}
                                    <span class="ms-4">
                                        {% if address.city %}{{ address.city }}{% endif %}
                                        {% if address.postal_code %} {{ address.postal_code }}{% endif %}
                                    </span>
                                    {% if address.country %}<br><span class="ms-4">{{ address.country }}</span>{% endif %}
                                </div>
                                {% endfor %}
                            {% endif %}
                            
                            {# Performer Telecoms #}
                            {% if performer.contact_info.telecoms %}
                                {% for telecom in performer.contact_info.telecoms %}
                                    {% if 'tel:' in telecom.value %}
                                        <div class="ms-3 mb-1">
                                            <i class="fa-solid fa-phone me-2 text-success"></i>
                                            <strong>Phone:</strong> {{ telecom.value|slice:"4:" }}
                                        </div>
                                    {% elif 'mailto:' in telecom.value %}
                                        <div class="ms-3 mb-1">
                                            <i class="fa-solid fa-envelope me-2 text-info"></i>
                                            <strong>Email:</strong> {{ telecom.value|slice:"7:" }}
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                    
                    {# PERFORMER'S REPRESENTED ORGANIZATION #}
                    {% if performer.organization %}
                    <div class="organization-section ms-3 mt-3 pt-3 border-top">
                        <h6 class="text-muted mb-2">
                            <i class="fa-solid fa-hospital me-2"></i>
                            Represented Organization
                        </h6>
                        
                        <div class="ms-3">
                            <p class="fw-bold mb-2">{{ performer.organization.name }}</p>
                            
                            {# Organization Contact Information #}
                            {% if performer.organization.contact_info %}
                            <div class="mb-3">
                                <strong class="d-block mb-2 text-muted">
                                    <i class="fa-solid fa-address-book me-2"></i>
                                    Organization Contact:
                                </strong>
                                
                                {# Organization Address #}
                                {% if performer.organization.contact_info.addresses %}
                                    {% for address in performer.organization.contact_info.addresses %}
                                    <div class="ms-3 mb-2 small">
                                        <i class="fa-solid fa-location-dot me-2 text-muted"></i>
                                        {% if address.street %}{{ address.street }}, {% endif %}
                                        {% if address.city %}{{ address.city }}{% endif %}
                                        {% if address.postal_code %} {{ address.postal_code }}{% endif %}
                                    </div>
                                    {% endfor %}
                                {% endif %}
                                
                                {# Organization Telecoms #}
                                {% if performer.organization.contact_info.telecoms %}
                                    {% for telecom in performer.organization.contact_info.telecoms %}
                                        {% if 'tel:' in telecom.value %}
                                            <div class="ms-3 mb-1 small">
                                                <i class="fa-solid fa-phone me-2 text-success"></i>
                                                {{ telecom.value|slice:"4:" }}
                                            </div>
                                        {% elif 'mailto:' in telecom.value %}
                                            <div class="ms-3 mb-1 small">
                                                <i class="fa-solid fa-envelope me-2 text-info"></i>
                                                {{ telecom.value|slice:"7:" }}
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                {% endif %}
                            </div>
                            {% endif %}
                            
                            {# Organization Identifiers #}
                            {% if performer.organization.identifiers %}
                            <div class="mb-2">
                                <strong class="d-block mb-1 text-muted">
                                    <i class="fa-solid fa-id-card me-2"></i>
                                    Organization ID:
                                </strong>
                                {% for identifier in performer.organization.identifiers %}
                                    <div class="ms-3 mb-1 small text-muted">
                                        {% if identifier.root %}Root: {{ identifier.root }}{% endif %}
                                        {% if identifier.extension %} | Extension: {{ identifier.extension }}{% endif %}
                                    </div>
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            {% endif %}
            
            {# Service Event Code (if present) #}
            {% if documentation_of.code %}
            <div class="mt-3 pt-3 border-top">
                <small class="text-muted">
                    <i class="fa-solid fa-code me-2"></i>
                    <strong>Service Event Code:</strong> {{ documentation_of.code }}
                    {% if documentation_of.code_system %}
                        <span class="ms-2">({{ documentation_of.code_system }})</span>
                    {% endif %}
                </small>
            </div>
            {% endif %}
                
            </div>
        </div>
    </div>
</div>
{% endif %}
