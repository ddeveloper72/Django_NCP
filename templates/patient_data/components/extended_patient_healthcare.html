{% load patient_filters %}

<!-- Extended Patient Healthcare Team Component -->
<h5><i class="fas fa-stethoscope me-2"></i>Healthcare Team</h5>

<!-- Document Author HCP -->
{% if healthcare_data and healthcare_data.author_hcp %}
    {% with author_hcp=healthcare_data.author_hcp %}
        <div class="mb-4">
            <div class="card healthcare-team-card">
                <div class="card-header bg-primary text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-user-md me-2"></i>
                        Document Author
                        <span class="badge bg-light text-primary ms-2">Primary HCP</span>
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <h6 class="card-title text-primary">
                                {% if author_hcp.title %}{{ author_hcp.title }} {% endif %}
                                {{ author_hcp.given_name|default:"" }} {{ author_hcp.family_name|default:"" }}
                                {% if not author_hcp.given_name and not author_hcp.family_name %}
                                    Document Author
                                {% endif %}
                            </h6>

                            {% if author_hcp.role %}
                                <p class="mb-2">
                                    <strong><i class="fas fa-user-tag me-1"></i>Role:</strong>
                                    <span class="badge bg-success">{{ author_hcp.role }}</span>
                                </p>
                            {% endif %}

                            {% if author_hcp.specialty %}
                                <p class="mb-2">
                                    <strong><i class="fas fa-stethoscope me-1"></i>Specialty:</strong>
                                    {{ author_hcp.specialty }}
                                </p>
                            {% endif %}
                        </div>

                        <div class="col-md-4">
                            {% if author_hcp.organization and author_hcp.organization.name %}
                                <div class="organization-info">
                                    <h6 class="text-muted">
                                        <i class="fas fa-building me-1"></i>Organization
                                    </h6>
                                    <p class="mb-1">{{ author_hcp.organization.name }}</p>
                                    {% if author_hcp.organization.organization_type %}
                                        <small class="text-muted">{{ author_hcp.organization.organization_type }}</small>
                                    {% endif %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endwith %}
{% endif %}

<!-- Legal Authenticator -->
{% if healthcare_data and healthcare_data.legal_authenticator %}
    {% with legal_auth=healthcare_data.legal_authenticator %}
        <div class="mb-4">
            <div class="card healthcare-team-card">
                <div class="card-header bg-warning text-dark">
                    <h6 class="mb-0">
                        <i class="fas fa-stamp me-2"></i>
                        Legal Authenticator
                        <span class="badge bg-dark text-white ms-2">Document Validator</span>
                    </h6>
                </div>
                <div class="card-body">
                    <h6 class="card-title text-warning">
                        {{ legal_auth.given_name|default:"" }} {{ legal_auth.family_name|default:"Legal Authenticator" }}
                    </h6>
                    {% if legal_auth.role %}
                        <p class="mb-2">
                            <strong><i class="fas fa-user-tag me-1"></i>Role:</strong>
                            <span class="badge bg-warning text-dark">{{ legal_auth.role }}</span>
                        </p>
                    {% endif %}
                </div>
            </div>
        </div>
    {% endwith %}
{% endif %}

<!-- Fallback content when no healthcare team data is available -->
{% if not healthcare_data or not healthcare_data.author_hcp and not healthcare_data.legal_authenticator and not healthcare_data.preferred_hcp %}
<div class="alert alert-info">
    <div class="d-flex align-items-center">
        <i class="fas fa-info-circle fa-2x me-3"></i>
        <div>
            <h6 class="mb-1">No Healthcare Team Information</h6>
            <p class="mb-0">Healthcare provider details are not available in the current document or have not been extracted.</p>
        </div>
    </div>
</div>
{% endif %}

    <!-- Legal Authenticator -->
    {% if healthcare_data.legal_authenticator %}
        {% with legal_auth=healthcare_data.legal_authenticator %}
            {% if legal_auth.given_name or legal_auth.family_name or legal_auth.role %}
                <div class="mb-4">
                    <div class="card healthcare-team-card">
                        <div class="card-header bg-warning text-dark">
                            <h6 class="mb-0">
                                <i class="fas fa-gavel me-2"></i>
                                Legal Authenticator
                                <span class="badge bg-dark text-white ms-2">Legal Authority</span>
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-8">
                                    <h6 class="card-title text-warning">
                                        {% if legal_auth.title %}{{ legal_auth.title }} {% endif %}
                                        {{ legal_auth.given_name|default:"" }} {{ legal_auth.family_name|default:"" }}
                                        {% if not legal_auth.given_name and not legal_auth.family_name %}
                                            Legal Authenticator
                                        {% endif %}
                                    </h6>

                                    {% if legal_auth.role %}
                                        <p class="mb-2">
                                            <strong><i class="fas fa-user-tag me-1"></i>Role:</strong>
                                            <span class="badge bg-warning text-dark">{{ legal_auth.role }}</span>
                                        </p>
                                    {% endif %}

                                    {% if legal_auth.specialty %}
                                        <p class="mb-2">
                                            <strong><i class="fas fa-certificate me-1"></i>Specialty:</strong>
                                            {{ legal_auth.specialty }}
                                        </p>
                                    {% endif %}
                                </div>

                                <div class="col-md-4">
                                    {% if legal_auth.organization.name %}
                                        <div class="organization-info">
                                            <h6 class="text-muted">
                                                <i class="fas fa-building me-1"></i>Organization
                                            </h6>
                                            <p class="mb-1">{{ legal_auth.organization.name }}</p>
                                            {% if legal_auth.organization.organization_type %}
                                                <small class="text-muted">{{ legal_auth.organization.organization_type }}</small>
                                            {% endif %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Contact Information for Legal Authenticator -->
                            {% if legal_auth.contact_info.addresses or legal_auth.contact_info.telecoms %}
                                <hr>
                                <h6 class="text-muted mb-3"><i class="fas fa-address-book me-1"></i>Contact Information</h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        {% for address in legal_auth.contact_info.addresses %}
                                            <p class="mb-2">
                                                <strong>Address:</strong><br>
                                                <small>
                                                    {% for line in address.streetAddressLine %}{{ line }}<br>{% endfor %}
                                                    {% if address.city %}{{ address.city }}{% endif %}
                                                    {% if address.postalCode %} {{ address.postalCode }}{% endif %}
                                                    {% if address.country %}<br>{{ address.country }}{% endif %}
                                                </small>
                                            </p>
                                        {% endfor %}
                                    </div>

                                    <div class="col-md-6">
                                        {% for telecom in legal_auth.contact_info.telecoms %}
                                            <p class="mb-1">
                                                <strong>
                                                    {% if 'tel:' in telecom.value %}
                                                        <i class="fas fa-phone me-1"></i>Contact:
                                                    {% elif 'mailto:' in telecom.value %}
                                                        <i class="fas fa-envelope me-1"></i>Email:
                                                    {% else %}
                                                        <i class="fas fa-phone-alt me-1"></i>Contact:
                                                    {% endif %}
                                                </strong>
                                                {% if 'tel:' in telecom.value %}
                                                    <a href="{{ telecom.value }}">{{ telecom.value|slice:"4:" }}</a>
                                                {% elif 'mailto:' in telecom.value %}
                                                    <a href="{{ telecom.value }}">{{ telecom.value|slice:"7:" }}</a>
                                                {% else %}
                                                    {{ telecom.value }}
                                                {% endif %}
                                            </p>
                                        {% endfor %}
                                    </div>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endwith %}
    {% endif %}

    <!-- Preferred HCP Organization -->
    {% if healthcare_data.preferred_hcp %}
        {% with preferred_hcp=healthcare_data.preferred_hcp %}
            {% if preferred_hcp.name or preferred_hcp.addresses or preferred_hcp.telecoms %}
                <div class="mb-4">
                    <div class="card healthcare-team-card">
                        <div class="card-header bg-info text-white">
                            <h6 class="mb-0">
                                <i class="fas fa-star me-2"></i>
                                Preferred Healthcare Provider
                                <span class="badge bg-light text-info ms-2">Primary Care</span>
                            </h6>
                        </div>
                        <div class="card-body">
                            <h6 class="card-title text-info">
                                {{ preferred_hcp.name|default:"Preferred Healthcare Organization" }}
                            </h6>

                            {% if preferred_hcp.organization_type %}
                                <p class="mb-3">
                                    <span class="badge bg-info">{{ preferred_hcp.organization_type }}</span>
                                </p>
                            {% endif %}

                            <div class="row">
                                <div class="col-md-6">
                                    {% for address in preferred_hcp.addresses %}
                                        <p class="mb-2">
                                            <strong><i class="fas fa-map-marker-alt me-1"></i>Address:</strong><br>
                                            <small>
                                                {% for line in address.streetAddressLine %}{{ line }}<br>{% endfor %}
                                                {% if address.city %}{{ address.city }}{% endif %}
                                                {% if address.postalCode %} {{ address.postalCode }}{% endif %}
                                                {% if address.country %}<br>{{ address.country }}{% endif %}
                                            </small>
                                        </p>
                                    {% endfor %}
                                </div>

                                <div class="col-md-6">
                                    {% for telecom in preferred_hcp.telecoms %}
                                        <p class="mb-1">
                                            <strong>
                                                {% if 'tel:' in telecom.value %}
                                                    <i class="fas fa-phone me-1"></i>Phone:
                                                {% elif 'mailto:' in telecom.value %}
                                                    <i class="fas fa-envelope me-1"></i>Email:
                                                {% else %}
                                                    <i class="fas fa-phone-alt me-1"></i>Contact:
                                                {% endif %}
                                            </strong>
                                            {% if 'tel:' in telecom.value %}
                                                <a href="{{ telecom.value }}">{{ telecom.value|slice:"4:" }}</a>
                                            {% elif 'mailto:' in telecom.value %}
                                                <a href="{{ telecom.value }}">{{ telecom.value|slice:"7:" }}</a>
                                            {% else %}
                                                {{ telecom.value }}
                                            {% endif %}
                                        </p>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endwith %}
    {% endif %}

    <!-- No Healthcare Team Message -->
    {% if not healthcare_data or not healthcare_data.author_hcp and not healthcare_data.legal_authenticator %}
        <div class="empty-state text-center py-4">
            <i class="fas fa-user-md fa-3x text-muted mb-3"></i>
            <h6>No Healthcare Team Information</h6>
            <p class="text-muted">No healthcare team information is available.</p>
        </div>
    {% endif %}

</div>
