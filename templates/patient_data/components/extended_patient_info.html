<!-- Extended Patient Information Main Component -->
{% load patient_filters %}
{% if patient_extended_data or administrative_data %}
<div class="row mb-4">
    <div class="col-12">
        <div class="card extended-patient-info">
            <div class="card-header bg-info text-white">
                <h4 class="mb-0">
                    <i class="fas fa-address-book me-2"></i>
                    Extended Patient Information
                </h4>
            </div>
            <div class="card-body">

                <!-- Extended Info Navigation Tabs -->
                <ul class="nav nav-tabs" id="extendedInfoTabs" role="tablist">
                    <!-- Contact Details Tab -->
                    <li class="nav-item" role="presentation">
                        <button class="nav-link tab-button active" id="contact-tab"
                            onclick="showExtendedPatientTab('contact')" type="button" role="tab"
                            aria-controls="contact" aria-selected="true">
                            <i class="fas fa-address-card me-1"></i>Contact Details
                            {% if patient_extended_data|safe_get:"patient_contact" or administrative_data|safe_get:"patient_contact_info" %}
                            <span class="badge bg-primary ms-1">1</span>
                            {% endif %}
                        </button>
                    </li>

                    <!-- Healthcare Team Tab -->
                    <li class="nav-item" role="presentation">
                        <button class="nav-link tab-button" id="healthcare-tab"
                            onclick="showExtendedPatientTab('healthcare')" type="button" role="tab"
                            aria-controls="healthcare" aria-selected="false">
                            <i class="fas fa-stethoscope me-1"></i>Healthcare Team
                            {% if patient_extended_data|safe_get:"authors" or administrative_data|safe_get:"authors" %}
                            <span class="badge bg-success ms-1">
                                {# Django: Calculate team count using template logic #}
                                {% if patient_extended_data|safe_get:"authors" %}
                                {{ patient_extended_data|safe_get:"authors"|length }}
                                {% elif administrative_data|safe_get:"authors" %}
                                {{ administrative_data|safe_get:"authors"|length }}
                                {% else %}
                                0
                                {% endif %}
                                {% if patient_extended_data|safe_get:"legal_authenticator" or administrative_data|safe_get:"legal_authenticator" %}
                                +1
                                {% endif %}
                                {% if patient_extended_data|safe_get:"custodian" or administrative_data|safe_get:"custodians" %}
                                +1
                                {% endif %}
                            </span>
                            {% endif %}
                        </button>
                    </li>

                    <!-- Document Info Tab -->
                    <li class="nav-item" role="presentation">
                        <button class="nav-link tab-button" id="document-tab"
                            onclick="showExtendedPatientTab('document')" type="button" role="tab"
                            aria-controls="document" aria-selected="false">
                            <i class="fas fa-file-medical-alt me-1"></i>Document Info
                        </button>
                    </li>
                </ul>

                <!-- Extended Info Tab Content -->
                <div class="tab-content mt-3" id="extendedInfoTabContent">

                    <!-- Contact Details Tab Pane -->
                    <div class="tab-pane active" id="extended-contact" style="display: block;">
                        {% include 'patient_data/components/extended_patient_contact.html' %}
                    </div>

                    <!-- Healthcare Team Tab Pane -->
                    <div class="tab-pane" id="extended-healthcare" style="display: none;">
                        {% include 'patient_data/components/extended_patient_healthcare.html' %}
                    </div>

                    <!-- Document Info Tab Pane -->
                    <div class="tab-pane" id="extended-document" style="display: none;">
                        {% include 'patient_data/components/extended_patient_document.html' %}
                    </div>

                </div>
            </div>
        </div>
    </div>
</div>
{% else %}
<!-- No Extended Data Available -->
<div class="row mb-4">
    <div class="col-12">
        <div class="alert alert-info">
            <h6><i class="fas fa-info-circle me-2"></i>Extended Patient Information</h6>
            <p>Extended patient information is not available for this document. The system was unable to extract additional patient data from the CDA content.</p>
        </div>
    </div>
</div>
{% endif %}
