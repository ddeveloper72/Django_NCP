{# Clinical Information Content Component - Simple Test Version #}
{% load patient_filters %}

<div class="clinical-information-container">
    {# Check if we have any clinical data #}
    {% if medications or allergies or problems or vital_signs or procedures or immunizations %}
        
        <div class="accordion" id="clinicalInformationAccordion">
            
            {# Medications Section #}
            {% if medications and medications|length > 0 %}
            <div class="accordion-item">
                <h2 class="accordion-header" id="heading-medications">
                    <button class="accordion-button bg-white border collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#collapse-medications"
                            aria-expanded="false"
                            aria-controls="collapse-medications"
                            style="color: #212529 !important; background-color: #ffffff !important;">
                        <i class="fa-solid fa-pills text-success me-2"></i>
                        <strong style="color: #212529 !important;">Medications</strong>
                        <span class="badge bg-success text-white ms-2">{{ medications|length }}</span>
                    </button>
                </h2>
                <div id="collapse-medications"
                     class="accordion-collapse collapse"
                     aria-labelledby="heading-medications">
                    <div class="accordion-body">
                        <p>Medications: {{ medications|length }} items found</p>
                        {% for med in medications %}
                        <div class="mb-2">
                            <strong>{{ med.name|default:"Medication" }}</strong>
                            {% if med.dose %} - {{ med.dose }}{% endif %}
                            {% if med.route %} ({{ med.route }}){% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}

            {# Allergies Section #}
            {% if allergies and allergies|length > 0 %}
            <div class="accordion-item">
                <h2 class="accordion-header" id="heading-allergies">
                    <button class="accordion-button bg-white border collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#collapse-allergies"
                            aria-expanded="false"
                            aria-controls="collapse-allergies"
                            style="color: #212529 !important; background-color: #ffffff !important;">
                        <i class="fa-solid fa-exclamation-triangle text-warning me-2"></i>
                        <strong style="color: #212529 !important;">Allergies and Adverse Reactions</strong>
                        <span class="badge bg-warning text-white ms-2">{{ allergies|length }}</span>
                    </button>
                </h2>
                <div id="collapse-allergies"
                     class="accordion-collapse collapse"
                     aria-labelledby="heading-allergies">
                    <div class="accordion-body">
                        <p>Allergies: {{ allergies|length }} items found</p>
                        {% for allergy in allergies %}
                        <div class="mb-2">
                            <strong>{{ allergy.substance|default:"Allergen" }}</strong>
                            {% if allergy.severity %} - {{ allergy.severity }} severity{% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}

            {# Problems Section #}
            {% if problems and problems|length > 0 %}
            <div class="accordion-item">
                <h2 class="accordion-header" id="heading-problems">
                    <button class="accordion-button bg-white border collapsed" type="button" data-bs-toggle="collapse"
                            data-bs-target="#collapse-problems"
                            aria-expanded="false"
                            aria-controls="collapse-problems"
                            style="color: #212529 !important; background-color: #ffffff !important;">
                        <i class="fa-solid fa-heart-pulse text-danger me-2"></i>
                        <strong style="color: #212529 !important;">Medical Problems</strong>
                        <span class="badge bg-danger text-white ms-2">{{ problems|length }}</span>
                    </button>
                </h2>
                <div id="collapse-problems"
                     class="accordion-collapse collapse"
                     aria-labelledby="heading-problems">
                    <div class="accordion-body">
                        <p>Problems: {{ problems|length }} items found</p>
                        {% for problem in problems %}
                        <div class="mb-2">
                            <strong>{{ problem.name|default:"Medical Problem" }}</strong>
                            {% if problem.status %} - {{ problem.status }}{% endif %}
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}

        </div>

    {% else %}
        {# No Clinical Information Available #}
        <div class="alert alert-info">
            <h6><i class="fa-solid fa-info-circle me-2"></i>No Clinical Information Available</h6>
            <p class="mb-0">No structured clinical information was found in this patient's records.</p>
        </div>
    {% endif %}
</div>